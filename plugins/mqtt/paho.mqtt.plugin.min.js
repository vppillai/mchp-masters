var pahoClient;!function(){freeboard.loadDatasourcePlugin({type_name:"paho_mqtt",display_name:"Paho MQTT",description:"Receive data from an MQTT server.",external_scripts:["plugins/mqtt/mqttws31.min.js"],settings:[{name:"server",display_name:"MQTT Server",type:"text",default_value:"mchp-masters.ddns.net",description:"Hostname for your MQTT Server",required:!0},{name:"port",display_name:"Port",type:"number",default_value:443,description:"The port to connect to the MQTT Server on",required:!0},{name:"use_ssl",display_name:"Use SSL",type:"boolean",description:"Use SSL/TLS to connect to the MQTT Server",default_value:!1},{name:"client_id",display_name:"Client Id",type:"text",default_value:"",required:!1},{name:"username",display_name:"Username",type:"text",default_value:"",required:!1},{name:"password",display_name:"Password",type:"text",default_value:"",required:!1},{name:"topic",display_name:"Topic",type:"text",description:"The topic to subscribe to",required:!0},{name:"json_data",display_name:"JSON messages?",type:"boolean",description:"If the messages on your topic are in JSON format they will be parsed so the individual fields can be used in freeboard widgets",default_value:!0}],newInstance:function(b,c,d){c(new a(b,d))}});var a=function(a,b){function f(){console.log("Connected to server"),pahoClient.subscribe(e.topic),"function"==typeof refreshPanels&&refreshPanels()}function g(a){0!==a.errorCode&&console.log("onConnectionLost:"+a.errorMessage)}function h(a){d.topic=a.destinationName,e.json_data?d.msg=JSON.parse(a.payloadString):d.msg=a.payloadString,b(d)}var c=this,d={},e=a;c.onSettingsChanged=function(a){pahoClient.disconnect(),d={},e=a,pahoClient.connect({onSuccess:f,userName:e.username,password:e.password,useSSL:e.use_ssl})},c.updateNow=function(){},c.onDispose=function(){pahoClient.isConnected()&&pahoClient.disconnect(),pahoClient={}},e.server=window.location.hostname,pahoClient=new Paho.MQTT.Client(e.server,e.port,e.client_id),pahoClient.onConnectionLost=g,pahoClient.onMessageArrived=h,pahoClient.connect({onSuccess:f,userName:e.username,password:e.password,useSSL:e.use_ssl})}}();
